[
    {
        "id": "98f04e36.3a6d",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ee116574.f1f048",
        "type": "inject",
        "z": "98f04e36.3a6d",
        "name": "set startup message",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "node-red-RC-controller flow successfully started",
        "payloadType": "str",
        "x": 180,
        "y": 40,
        "wires": [
            [
                "6c5aa1bc.4a843",
                "50f93e8d.4482f"
            ]
        ]
    },
    {
        "id": "6c5aa1bc.4a843",
        "type": "debug",
        "z": "98f04e36.3a6d",
        "name": "write startup message to console.",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 40,
        "wires": []
    },
    {
        "id": "dd6aff29.bea9f",
        "type": "daemon",
        "z": "98f04e36.3a6d",
        "name": "cat out",
        "command": "cat",
        "args": "/var/lirc_raw_data/lirc0_events",
        "autorun": true,
        "cr": false,
        "redo": true,
        "op": "lines",
        "closer": "SIGKILL",
        "x": 140,
        "y": 200,
        "wires": [
            [
                "f3583679.ec0d38",
                "379f349c.70463c"
            ],
            [],
            []
        ]
    },
    {
        "id": "f3583679.ec0d38",
        "type": "debug",
        "z": "98f04e36.3a6d",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 320,
        "y": 180,
        "wires": []
    },
    {
        "id": "379f349c.70463c",
        "type": "change",
        "z": "98f04e36.3a6d",
        "name": "parse input",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "(\t  $splitted:=payload~>$split(' ');\t  $type := $splitted[0];\t  {\t     \"type\":$splitted[0],\t     \"duration_microsec\" : $splitted[1]~>$number()\t  };\t  $is_valid := ($type=\"pulse\") or ($type=\"space\");\t  $is_valid \t  ?{\t     \"type\":$type,\t     \"duration_microsec\" : $splitted[1]~>$number()\t    }\t  :{\t     \"type\": \"invalid\",\t     \"input\": payload\t  }\t)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 210,
        "y": 300,
        "wires": [
            [
                "a38879ad.617888"
            ]
        ]
    },
    {
        "id": "a38879ad.617888",
        "type": "switch",
        "z": "98f04e36.3a6d",
        "name": "is invalid",
        "property": "payload.type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "invalid",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 200,
        "y": 360,
        "wires": [
            [
                "4f74baee.afb814"
            ],
            [
                "eb0f5023.a7bc7",
                "d9963875.299d18",
                "a047b1c6.f640c"
            ]
        ]
    },
    {
        "id": "4f74baee.afb814",
        "type": "debug",
        "z": "98f04e36.3a6d",
        "name": "invalid input",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 280,
        "wires": []
    },
    {
        "id": "eb0f5023.a7bc7",
        "type": "debug",
        "z": "98f04e36.3a6d",
        "name": "valid input",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 450,
        "y": 320,
        "wires": []
    },
    {
        "id": "d9963875.299d18",
        "type": "switch",
        "z": "98f04e36.3a6d",
        "name": "",
        "property": "payload.duration_microsec",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "2000",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 430,
        "y": 360,
        "wires": [
            [
                "a2a7e6a4.50c168"
            ]
        ]
    },
    {
        "id": "a2a7e6a4.50c168",
        "type": "debug",
        "z": "98f04e36.3a6d",
        "name": "more than 2 msec",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 360,
        "wires": []
    },
    {
        "id": "50f93e8d.4482f",
        "type": "change",
        "z": "98f04e36.3a6d",
        "name": "flow.rc_key = []",
        "rules": [
            {
                "t": "set",
                "p": "rc_key",
                "pt": "flow",
                "to": "[]",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "964a261d.f4d158",
        "type": "switch",
        "z": "98f04e36.3a6d",
        "name": "long pulse ?",
        "property": "payload.type = \"pulse\" and payload.duration_microsec > 20000",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 210,
        "y": 500,
        "wires": [
            [
                "b82c52e5.c504b",
                "703e3e93.997c8"
            ]
        ]
    },
    {
        "id": "b82c52e5.c504b",
        "type": "debug",
        "z": "98f04e36.3a6d",
        "name": "end recording",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 480,
        "y": 500,
        "wires": []
    },
    {
        "id": "a047b1c6.f640c",
        "type": "change",
        "z": "98f04e36.3a6d",
        "name": "append to flow.rc_key",
        "rules": [
            {
                "t": "set",
                "p": "rc_key",
                "pt": "msg",
                "to": "rc_key",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "rc_key",
                "pt": "flow",
                "to": "[ rc_key, payload ]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 240,
        "y": 440,
        "wires": [
            [
                "964a261d.f4d158"
            ]
        ]
    },
    {
        "id": "703e3e93.997c8",
        "type": "change",
        "z": "98f04e36.3a6d",
        "name": "conv to sequences",
        "rules": [
            {
                "t": "set",
                "p": "rc_key",
                "pt": "msg",
                "to": "rc_key",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "(\t\t  $long_spaces := rc_key#$i[type = \"space\" and duration_microsec > 10000].$i[];\t  $long_spaces#$i.{\t    \"begin\" : $,\t    \"end\" : $long_spaces[$i+1]~>$exists() \t            ? $long_spaces[$i+1]-1\t            : ($$.rc_key~>$count()) -1\t  }.(\t      $begin := $.begin;\t      $end := $.end;\t      { \"sequence\" :  $$.rc_key#$i[$begin<=$i and $i <= $end] }\t\t    )[]\t)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 560,
        "wires": [
            [
                "9081eb14.635a68",
                "d4b684c1.d8d978"
            ]
        ]
    },
    {
        "id": "9081eb14.635a68",
        "type": "debug",
        "z": "98f04e36.3a6d",
        "name": "RC sequences",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 560,
        "wires": []
    },
    {
        "id": "d4b684c1.d8d978",
        "type": "change",
        "z": "98f04e36.3a6d",
        "name": "flow.rc_key = []",
        "rules": [
            {
                "t": "set",
                "p": "rc_key",
                "pt": "flow",
                "to": "[]",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 600,
        "wires": [
            []
        ]
    }
]